<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamFinder Pro | Detail</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #050508; --accent: #e50914; --text: #ffffff; --sub-text: #b3b3b3; --border: rgba(255, 255, 255, 0.1); --glass: rgba(10, 10, 15, 0.8); }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; }
        .container { max-width: 1300px; margin: 0 auto; padding: 0 20px; width: 100%; }

        nav.main-nav { background: rgba(5, 5, 8, 0.95); border-bottom: 1px solid var(--border); padding: 15px 0; position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(15px); }
        .nav-container { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.6rem; font-weight: 900; text-decoration: none; color: #fff; letter-spacing: -1.5px; cursor: pointer; }
        .logo span { color: var(--accent); }

        .full-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background-size: cover; background-position: center; z-index: -2; transition: 0.5s; }
        .full-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: linear-gradient(to bottom, rgba(5, 5, 8, 0.3) 0%, rgba(5, 5, 8, 1) 85%); z-index: -1; }
        
        .btn-back { display: inline-flex; align-items: center; background: rgba(255, 255, 255, 0.1); padding: 10px 20px; border-radius: 30px; color: #fff; border: 1px solid var(--border); cursor: pointer; margin-top: 30px; margin-bottom: 30px; backdrop-filter: blur(10px); transition: 0.3s; text-decoration: none;}
        .btn-back:hover { background: var(--accent); }

        .detail-wrapper { display: flex; gap: 50px; flex-wrap: wrap; align-items: flex-start; padding-bottom: 40px; }
        .detail-poster { width: 300px; flex-shrink: 0; border-radius: 20px; border: 1px solid var(--border); box-shadow: 0 20px 50px rgba(0, 0, 0, 0.9); }
        .detail-info { flex: 1; min-width: 300px; padding-top: 10px; }
        .detail-title { font-size: clamp(2.5rem, 5vw, 4rem); font-weight: 900; margin: 0 0 15px 0; line-height: 1.1; }
        
        .genre-pill { background: rgba(255, 255, 255, 0.1); border: 1px solid var(--border); padding: 8px 18px; border-radius: 30px; font-size: 0.85rem; font-weight: 600; margin-right: 10px; margin-bottom: 10px; display: inline-block; cursor: pointer; transition: 0.3s; }
        .genre-pill:hover { background: var(--accent); border-color: white; }

        .streaming-container { background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--border); border-radius: 30px; padding: 40px; margin-bottom: 80px; }
        .p-row { display: flex; align-items: center; gap: 20px; padding: 20px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
        .p-logo { width: 55px; height: 55px; border-radius: 14px; }
        .c-badge { background: rgba(229, 9, 20, 0.1); color: var(--accent); padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 800; border: 1px solid rgba(229, 9, 20, 0.2); display: flex; gap: 6px; }
        .c-badge span { color: #fff; font-weight: 400; }

        @media (max-width: 768px) {
            .detail-wrapper { justify-content: center; }
            .detail-poster { width: 250px; }
            .detail-info { text-align: center; }
            .genre-list { justify-content: center; }
        }
        footer { background: #08080a; padding: 60px 0 30px; border-top: 1px solid var(--border); margin-top: auto; }
    </style>
</head>
<body>

    <nav class="main-nav">
        <div class="container nav-container">
            <a href="index.html" class="logo">STREAM<span>FINDER</span></a>
            <div style="font-size: 0.8rem; color: var(--sub-text); font-weight: 600; letter-spacing: 1px;">GLOBAL RELEASE TRACKER</div>
        </div>
    </nav>

    <main class="container">
        <div id="bgCanvas" class="full-backdrop"></div>
        <div class="full-overlay"></div>
        <a href="index.html" class="btn-back">← Back to Home</a>
        
        <div id="detailHero" class="detail-wrapper">
            <p style="color: var(--sub-text);">Loading details...</p>
        </div>

        <div class="streaming-container">
            <h3 style="margin-top: 0; color: var(--sub-text); font-size: 0.8rem; letter-spacing: 2px; text-transform: uppercase;">Streaming Availability by Region</h3>
            <div id="dProviders"></div>
        </div>
    </main>

    <footer>
        <div class="container" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
            <div class="logo" onclick="window.location.href='index.html'">STREAM<span>FINDER</span></div>
            <div style="color: var(--sub-text); font-size: 0.9rem;">© 2025 StreamFinder. Data by TMDB.</div>
        </div>
    </footer>

    <script>
        const API_KEY = 'a820f2b45d233c0cc0c97d078536074f';
        const IMG = 'https://image.tmdb.org/t/p/original';
        const regionNames = new Intl.DisplayNames(['en'], { type: 'region' });

        window.onload = async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            const type = urlParams.get('type');

            if (!id || !type) {
                window.location.href = 'index.html';
                return;
            }

            try {
                const [dRes, pRes, cRes] = await Promise.all([
                    fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${API_KEY}`),
                    fetch(`https://api.themoviedb.org/3/${type}/${id}/watch/providers?api_key=${API_KEY}`),
                    fetch(`https://api.themoviedb.org/3/${type}/${id}/credits?api_key=${API_KEY}`)
                ]);

                const m = await dRes.json();
                const providers = await pRes.json();
                const credits = await cRes.json();

                document.getElementById('bgCanvas').style.backgroundImage = `url(${IMG + (m.backdrop_path || m.poster_path)})`;

                const year = (m.release_date || m.first_air_date || '').split('-')[0];
                
                // UPDATE GENRE: Menambahkan onclick yang mengarah ke index.html dengan parameter
                const genresHtml = (m.genres || []).map(g => 
                    `<span class="genre-pill" onclick="window.location.href='index.html?genreId=${g.id}&genreName=${encodeURIComponent(g.name)}'">${g.name}</span>`
                ).join('');
                
                const tagline = m.tagline ? `<p style="font-style: italic; color: var(--sub-text); margin: 0 0 20px 0;">"${m.tagline}"</p>` : '';
                const castList = (credits.cast || []).filter(c => c.profile_path).slice(0, 5);
                const castHtml = castList.map(c => `
                    <div style="display: inline-block; margin-right: 15px; text-align: center; width: 70px;">
                        <img src="${IMG + c.profile_path}" style="width: 70px; height: 70px; object-fit: cover; border-radius: 50%; border: 2px solid var(--border);">
                        <div style="font-size: 0.75rem; font-weight: 600; margin-top: 5px; color: var(--text); overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${c.name}</div>
                    </div>
                `).join('');

                const runtime = type === 'movie' ? (m.runtime ? `${Math.floor(m.runtime / 60)}h ${m.runtime % 60}m` : '') : '';
                const episodeCount = type === 'tv' ? (m.number_of_episodes ? `${m.number_of_episodes} Episodes` : '') : '';
                const infoDuration = runtime || episodeCount || '';
                const language = m.original_language ? `Original Language: ${m.original_language.toUpperCase()}` : 'N/A';
                const status = m.status || 'N/A';

                const isMobile = window.innerWidth <= 768;
                const alignStyle = isMobile ? 'justify-content: center; text-align: center;' : 'justify-content: flex-start; text-align: left;';
                const textStyle = isMobile ? 'text-align: center;' : 'text-align: left;';

                document.getElementById('detailHero').innerHTML = `
                    <img src="${IMG + m.poster_path}" class="detail-poster">
                    <div class="detail-info">
                        <h1 class="detail-title">${m.title || m.name}</h1>
                        ${tagline}
                        <div style="display:flex; gap:15px; align-items:center; color:var(--sub-text); margin-bottom:20px; font-weight:700; flex-wrap: wrap; ${alignStyle}">
                            <span style="color:#ffc107">★ ${m.vote_average ? m.vote_average.toFixed(1) : '0.0'}</span>
                            <span>•</span> <span>${year}</span>
                            <span>•</span> <span style="text-transform:uppercase">${type}</span>
                            ${infoDuration ? `<span>•</span> <span>${infoDuration}</span>` : ''}
                        </div>
                        <div class="genre-list" style="margin-bottom: 25px; display: flex; flex-wrap: wrap; ${alignStyle}">${genresHtml}</div>
                        
                        <h3 style="margin: 0 0 10px 0; color: var(--text); ${textStyle}">Overview</h3>
                        <p style="font-size:1.1rem; line-height:1.8; color:#eee; max-width:800px; margin-bottom: 40px; ${textStyle}">${m.overview || 'No synopsis available.'}</p>

                        <h3 style="margin: 0 0 10px 0; color: var(--text); ${textStyle}">Top Billed Cast</h3>
                        <div style="margin-bottom: 40px; display: flex; flex-wrap: wrap; gap: 10px; ${alignStyle}">${castHtml || '<p style="color:var(--sub-text); font-size: 0.9rem;">No cast information available.</p>'}</div>

                        <h3 style="margin: 0 0 10px 0; color: var(--text); ${textStyle}">Additional Info</h3>
                        <div style="font-size: 0.95rem; color: var(--sub-text); ${textStyle}">
                            <p><strong>Status:</strong> ${status}</p>
                            <p><strong>Language:</strong> ${language}</p>
                        </div>
                    </div>
                `;

                renderProviders(providers);
            } catch (e) {
                console.error(e);
                document.getElementById('detailHero').innerHTML = '<p>Error loading content.</p>';
            }
        };

        function renderProviders(providers) {
            const pList = document.getElementById('dProviders');
            pList.innerHTML = '';
            const results = providers.results || {};
            const platMap = {};

            Object.keys(results).forEach(code => {
                const country = results[code];
                const all = [...(country.flatrate || []), ...(country.rent || []), ...(country.buy || [])];
                all.forEach(p => {
                    if (!platMap[p.provider_name]) platMap[p.provider_name] = { logo: p.logo_path, countries: [] };
                    if (!platMap[p.provider_name].countries.find(c => c.code === code)) {
                        let fullCountryName = code;
                        try { fullCountryName = regionNames.of(code); } catch (e) {}
                        platMap[p.provider_name].countries.push({ code, name: fullCountryName });
                    }
                });
            });

            const keys = Object.keys(platMap);
            if (keys.length === 0) pList.innerHTML = '<p style="color:var(--sub-text);">No streaming data found.</p>';
            keys.forEach(name => {
                const data = platMap[name];
                data.countries.sort((a, b) => a.name.localeCompare(b.name));
                const row = document.createElement('div');
                row.className = 'p-row';
                row.innerHTML = `
                    <img src="${IMG + data.logo}" class="p-logo">
                    <div>
                        <div style="font-weight:bold; margin-bottom:8px; font-size:1.1rem;">${name}</div>
                        <div style="display:flex; flex-wrap:wrap; gap:8px;">
                            ${data.countries.map(c => `<span class="c-badge"><b>${c.code}</b> <span>${c.name}</span></span>`).join('')}
                        </div>
                    </div>
                `;
                pList.appendChild(row);
            });
        }
    </script>
</body>
</html>
