<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamFinder Pro | Detail</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        /* CSS SAMA DENGAN SEBELUMNYA */
        :root { --bg: #050508; --accent: #e50914; --text: #ffffff; --sub-text: #b3b3b3; --border: rgba(255, 255, 255, 0.1); --glass: rgba(10, 10, 15, 0.9); }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; }
        .container { max-width: 1300px; margin: 0 auto; padding: 0 20px; width: 100%; }

        nav.main-nav { position: sticky; top: 0; z-index: 1000; padding: 15px 0; transition: 0.4s; background: transparent; }
        nav.main-nav.scrolled { background: var(--glass); border-bottom: 1px solid var(--border); backdrop-filter: blur(15px); }
        .nav-container { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.6rem; font-weight: 900; text-decoration: none; color: #fff; letter-spacing: -1.5px; cursor: pointer; }
        .logo span { color: var(--accent); }
        .nav-menu { display: flex; gap: 25px; align-items: center; }
        .nav-item { color: var(--sub-text); text-decoration: none; font-size: 0.9rem; font-weight: 600; transition: 0.3s; cursor: pointer; }
        .nav-item:hover, .nav-item.active { color: #fff; }
        .list-badge { background: var(--accent); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; margin-left: 5px; vertical-align: middle; }

        .full-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background-size: cover; background-position: center; z-index: -2; transition: 0.5s; opacity: 0; }
        .full-backdrop.loaded { opacity: 0.4; }
        .full-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: linear-gradient(to bottom, rgba(5,5,8,0.2) 0%, rgba(5,5,8,0.9) 60%, rgba(5,5,8,1) 90%); z-index: -1; }
        .btn-back { display: inline-flex; align-items: center; background: rgba(255, 255, 255, 0.1); padding: 10px 20px; border-radius: 30px; color: #fff; border: 1px solid var(--border); cursor: pointer; margin-top: 30px; margin-bottom: 30px; backdrop-filter: blur(10px); transition: 0.3s; text-decoration: none;}
        .btn-back:hover { background: var(--accent); }
        .detail-wrapper { display: flex; gap: 50px; flex-wrap: wrap; align-items: flex-start; padding-bottom: 40px; }
        .detail-poster { width: 300px; flex-shrink: 0; border-radius: 20px; border: 1px solid var(--border); box-shadow: 0 20px 50px rgba(0, 0, 0, 0.9); }
        .detail-info { flex: 1; min-width: 300px; padding-top: 10px; }
        .detail-title { font-size: clamp(2.5rem, 5vw, 4rem); font-weight: 900; margin: 0 0 15px 0; line-height: 1.1; }
        .genre-pill { background: rgba(255, 255, 255, 0.1); border: 1px solid var(--border); padding: 8px 18px; border-radius: 30px; font-size: 0.85rem; font-weight: 600; margin-right: 10px; margin-bottom: 10px; display: inline-block; cursor: pointer; transition: 0.3s; }
        .genre-pill:hover { background: var(--accent); border-color: white; }
        .action-buttons { display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
        .btn-action { padding: 12px 24px; border-radius: 8px; font-weight: 700; cursor: pointer; border: none; display: flex; align-items: center; gap: 8px; transition: 0.3s; }
        .btn-trailer { background: #fff; color: #000; }
        .btn-trailer:hover { background: #ddd; }
        .btn-watchlist { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid var(--border); }
        .btn-watchlist.active, .btn-watchlist:hover { background: var(--accent); border-color: var(--accent); }
        .btn-share { background: transparent; color: var(--sub-text); border: 1px solid var(--border); }
        .btn-share:hover { background: rgba(255,255,255,0.1); color: #fff; border-color: #fff; }
        .cast-item { display: inline-block; margin-right: 15px; text-align: center; width: 80px; cursor: pointer; transition: 0.3s; }
        .cast-item:hover { transform: translateY(-5px); }
        .cast-item img { width: 70px; height: 70px; object-fit: cover; border-radius: 50%; border: 2px solid var(--border); transition: 0.3s; }
        .cast-item:hover img { border-color: var(--accent); }
        .section-header { margin: 40px 0 20px; font-size: 1.3rem; border-left: 4px solid var(--accent); padding-left: 15px; }
        .season-list { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 15px; }
        .season-card { min-width: 140px; width: 200px; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 10px; border: 1px solid var(--border); text-align: center; }
        .season-card img { width: 100%; border-radius: 6px; aspect-ratio: 2/3; object-fit: cover; margin-bottom: 8px; }
        .season-title { font-size: 0.8rem; font-weight: bold; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .season-ep { font-size: 0.7rem; color: var(--sub-text); margin-top: 3px; }
        .rec-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .rec-card { cursor: pointer; transition: 0.3s; }
        .rec-card:hover { transform: scale(1.05); }
        .rec-card img { width: 100%; border-radius: 8px; aspect-ratio: 2/3; object-fit: cover; }
        .streaming-container { background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--border); border-radius: 30px; padding: 40px; margin: 40px 0 80px; }
        .p-row { display: flex; align-items: center; gap: 20px; padding: 20px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
        .p-logo { width: 55px; height: 55px; border-radius: 14px; }
        .c-badge { background: rgba(229, 9, 20, 0.1); color: var(--accent); padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 800; border: 1px solid rgba(229, 9, 20, 0.2); display: flex; gap: 6px; }
        .c-badge span { color: #fff; font-weight: 400; }
        .trailer-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center; }
        .video-container { position: relative; width: 85%; max-width: 900px; aspect-ratio: 16/9; }
        .close-trailer { position: absolute; top: -40px; right: 0; color: white; font-size: 30px; cursor: pointer; }
        .skeleton { background: #222; position: relative; overflow: hidden; border-radius: 8px; }
        .skeleton-text { height: 20px; margin-bottom: 10px; width: 60%; }
        .skeleton-title { height: 40px; width: 80%; margin-bottom: 20px; }
        .skeleton-poster { width: 300px; height: 450px; }
        .skeleton::after { content: ""; position: absolute; top: 0; right: 0; bottom: 0; left: 0; transform: translateX(-100%); background-image: linear-gradient(90deg, rgba(255, 255, 255, 0) 0, rgba(255, 255, 255, 0.05) 20%, rgba(255, 255, 255, 0.1) 60%, rgba(255, 255, 255, 0)); animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 100% { transform: translateX(100%); } }
        .error-container { text-align: center; padding: 100px 20px; }
        .error-code { font-size: 5rem; font-weight: 900; color: var(--accent); margin: 0; }
        @media (max-width: 768px) { .detail-wrapper { justify-content: center; } .detail-poster { width: 250px; } .detail-info { text-align: center; } .action-buttons { justify-content: center; } .genre-list { justify-content: center; } .skeleton-poster { width: 250px; height: 375px; margin: 0 auto; } .nav-menu { display: none; } }
        footer { background: #08080a; padding: 60px 0 30px; border-top: 1px solid var(--border); margin-top: auto; }
    </style>
</head>
<body>
<nav class="main-nav" id="navbar">
        <div class="container nav-container">
            <a href="/" class="logo">STREAM<span>FINDER</span></a>
            
            <div class="nav-menu">
                <a href="/" class="nav-item">Home</a>
                
                <a href="/?tab=movie" class="nav-item">Movies</a>
                
                <a href="/?tab=tv" class="nav-item">TV Shows</a>
                
                <a href="/?tab=list" class="nav-item">My List <span class="list-badge" id="navCount">0</span></a>
            </div>
        </div>
</nav>

    <main class="container">
        <div id="bgCanvas" class="full-backdrop"></div>
        <div class="full-overlay"></div>
        <a href="/" class="btn-back">← Back to Home</a>
        
        <div id="skeletonLoader" class="detail-wrapper">
            <div class="skeleton skeleton-poster"></div>
            <div class="detail-info">
                <div class="skeleton skeleton-title"></div>
                <div class="skeleton skeleton-text" style="width: 40%"></div>
                <div class="skeleton skeleton-text" style="width: 90%; height: 100px; margin-top: 30px;"></div>
            </div>
        </div>

        <div id="detailHero" class="detail-wrapper" style="display: none;"></div>

        <div id="extraSections" style="display: none;">
            <div id="seasonsSection"></div>
            <div class="streaming-container">
                <h3 style="margin-top: 0; color: var(--sub-text); font-size: 0.8rem; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 20px;">Streaming Availability</h3>
                <div id="dProviders"></div>
            </div>
            <h3 class="section-header">You May Also Like</h3>
            <div id="recommendationsGrid" class="rec-list"></div>
        </div>

        <div id="errorContainer" class="error-container" style="display: none;">
            <h1 class="error-code">404</h1>
            <h2>Movie Not Found</h2>
            <p style="color: var(--sub-text); margin-bottom: 30px;">We couldn't find the title you're looking for.</p>
            <a href="/" class="btn-back" style="display: inline-block; margin: 0;">Go Home</a>
        </div>
    </main>

    <div id="trailerModal" class="trailer-modal" onclick="closeTrailer()">
        <div class="video-container" onclick="event.stopPropagation()">
            <div class="close-trailer" onclick="closeTrailer()">×</div>
            <iframe id="youtubeFrame" width="100%" height="100%" src="" frameborder="0" allowfullscreen></iframe>
        </div>
    </div>

    <footer>
        <div class="container" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
            <div class="logo" onclick="window.location.href='/'">STREAM<span>FINDER</span></div>
            <div style="color: var(--sub-text); font-size: 0.9rem;">© 2025 StreamFinder. Data by TMDB.</div>
        </div>
    </footer>

    <script>
        const API_KEY = 'a820f2b45d233c0cc0c97d078536074f';
        const IMG = 'https://image.tmdb.org/t/p/original';
        const regionNames = new Intl.DisplayNames(['en'], { type: 'region' });

        window.onload = async () => {
            updateNavCount();
            const path = window.location.pathname; 
            const parts = path.split('/').filter(part => part); 
            let type = (parts[0] === 'movie' || parts[0] === 'tv') ? parts[0] : null; 
            let id = parts[1];

            if (!id || !type) {
                const urlParams = new URLSearchParams(window.location.search);
                id = urlParams.get('id');
                type = urlParams.get('type');
            }

            if (!id || !type) { render404(); return; }

            try {
                const [dRes, pRes, cRes, vRes, rRes] = await Promise.all([
                    fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${API_KEY}`),
                    fetch(`https://api.themoviedb.org/3/${type}/${id}/watch/providers?api_key=${API_KEY}`),
                    fetch(`https://api.themoviedb.org/3/${type}/${id}/credits?api_key=${API_KEY}`),
                    fetch(`https://api.themoviedb.org/3/${type}/${id}/videos?api_key=${API_KEY}`),
                    fetch(`https://api.themoviedb.org/3/${type}/${id}/recommendations?api_key=${API_KEY}`)
                ]);

                if (!dRes.ok) throw new Error('Not Found');

                const m = await dRes.json();
                const providers = await pRes.json();
                const credits = await cRes.json();
                const videos = await vRes.json();
                const recommendations = await rRes.json();

                document.getElementById('skeletonLoader').style.display = 'none';
                document.getElementById('detailHero').style.display = 'flex';
                document.getElementById('extraSections').style.display = 'block';

                const bg = document.getElementById('bgCanvas');
                bg.style.backgroundImage = `url(${IMG + (m.backdrop_path || m.poster_path)})`;
                bg.classList.add('loaded');

                const year = (m.release_date || m.first_air_date || '').split('-')[0];
                const genresHtml = (m.genres || []).map(g => 
                    `<span class="genre-pill" onclick="window.location.href='/?genreId=${g.id}&genreName=${encodeURIComponent(g.name)}'">${g.name}</span>`
                ).join('');
                
                const trailer = videos.results.find(v => v.site === 'YouTube' && v.type === 'Trailer') || videos.results[0];
                const trailerKey = trailer ? trailer.key : null;

                const castList = (credits.cast || []).filter(c => c.profile_path).slice(0, 6);
                const castHtml = castList.map(c => `
                    <div class="cast-item" onclick="window.location.href='/?personId=${c.id}&personName=${encodeURIComponent(c.name)}'">
                        <img src="${IMG + c.profile_path}">
                        <div style="font-size: 0.75rem; font-weight: 600; margin-top: 5px; color: var(--text); overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${c.name}</div>
                    </div>
                `).join('');

                const isSaved = checkWatchlist(m.id);
                const watchlistBtnText = isSaved ? 'Remove from List' : 'Add to List';
                const watchlistBtnClass = isSaved ? 'btn-watchlist active' : 'btn-watchlist';

                const runtime = type === 'movie' ? (m.runtime ? `${Math.floor(m.runtime / 60)}h ${m.runtime % 60}m` : '') : '';
                const episodeCount = type === 'tv' ? (m.number_of_episodes ? `${m.number_of_episodes} Episodes` : '') : '';
                const infoDuration = runtime || episodeCount || '';
                
                document.getElementById('detailHero').innerHTML = `
                    <img src="${IMG + m.poster_path}" class="detail-poster">
                    <div class="detail-info">
                        <h1 class="detail-title">${m.title || m.name}</h1>
                        ${m.tagline ? `<p style="font-style: italic; color: var(--sub-text); margin: 0 0 20px 0;">"${m.tagline}"</p>` : ''}
                        
                        <div class="action-buttons">
                            ${trailerKey ? `<button class="btn-action btn-trailer" onclick="playTrailer('${trailerKey}')">▶ Watch Trailer</button>` : ''}
                            <button id="wlBtn" class="btn-action ${watchlistBtnClass}" onclick="toggleWatchlist('${m.id}', '${type}', '${m.poster_path}', '${escapeHtml(m.title || m.name)}', '${m.vote_average}')">
                                ${isSaved ? '✓' : '+'} ${watchlistBtnText}
                            </button>
                            <button class="btn-action btn-share" onclick="shareMovie('${escapeHtml(m.title || m.name)}', window.location.href)">
                                ➦ Share
                            </button>
                        </div>

                        <div style="display:flex; gap:15px; align-items:center; color:var(--sub-text); margin-bottom:20px; font-weight:700; flex-wrap: wrap;">
                            <span style="color:#ffc107">★ ${m.vote_average ? m.vote_average.toFixed(1) : '0.0'}</span>
                            <span>•</span> <span>${year}</span>
                            <span>•</span> <span style="text-transform:uppercase">${type}</span>
                            ${infoDuration ? `<span>•</span> <span>${infoDuration}</span>` : ''}
                        </div>
                        <div class="genre-list" style="margin-bottom: 25px; display: flex; flex-wrap: wrap;">${genresHtml}</div>
                        
                        <h3 style="margin: 0 0 10px 0; color: var(--text);">Overview</h3>
                        <p style="font-size:1.1rem; line-height:1.8; color:#eee; max-width:800px; margin-bottom: 40px;">${m.overview || 'No synopsis available.'}</p>

                        <h3 style="margin: 0 0 10px 0; color: var(--text);">Top Cast</h3>
                        <div style="margin-bottom: 40px; display: flex; flex-wrap: wrap; gap: 10px;">${castHtml || '<p style="color:var(--sub-text); font-size: 0.9rem;">No cast info.</p>'}</div>
                    </div>
                `;

                if (type === 'tv' && m.seasons) {
                    const seasonsHtml = m.seasons.filter(s => s.poster_path && s.season_number > 0).map(s => `
                        <div class="season-card">
                            <img src="${IMG + s.poster_path}">
                            <div class="season-title">${s.name}</div>
                            <div class="season-ep">${s.episode_count} Eps</div>
                        </div>
                    `).join('');
                    if (seasonsHtml) document.getElementById('seasonsSection').innerHTML = `<h3 class="section-header">Seasons</h3><div class="season-list">${seasonsHtml}</div>`;
                }

                const recsHtml = recommendations.results.slice(0, 7).map(r => {
                    if(!r.poster_path) return '';
                    return `
                        <div class="rec-card" onclick="window.location.href='/${type}/${r.id}'">
                            <img src="${IMG + r.poster_path}" loading="lazy">
                            <div style="font-size:0.8rem; margin-top:5px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-weight:bold;">${r.title || r.name}</div>
                        </div>
                    `;
                }).join('');
                document.getElementById('recommendationsGrid').innerHTML = recsHtml || '<p style="color:var(--sub-text)">No recommendations available.</p>';

                renderProviders(providers.results || {});

            } catch (e) {
                console.error(e);
                render404();
            }
        };

        function render404() {
            document.getElementById('skeletonLoader').style.display = 'none';
            document.getElementById('errorContainer').style.display = 'block';
        }

        function renderProviders(results) {
            const pList = document.getElementById('dProviders');
            pList.innerHTML = '';
            
            const platMap = {};
            Object.keys(results).forEach(code => {
                const country = results[code];
                const all = [...(country.flatrate || []), ...(country.rent || []), ...(country.buy || [])];
                
                all.forEach(p => {
                    if (!platMap[p.provider_name]) platMap[p.provider_name] = { logo: p.logo_path, countries: [] };
                    if (!platMap[p.provider_name].countries.find(c => c.code === code)) {
                        let fullCountryName = code;
                        try { fullCountryName = regionNames.of(code); } catch (e) {}
                        platMap[p.provider_name].countries.push({ code, name: fullCountryName });
                    }
                });
            });

            const keys = Object.keys(platMap);
            if (keys.length === 0) {
                pList.innerHTML = `<p style="color:var(--sub-text);">No streaming data found.</p>`;
                return;
            }

            keys.forEach(name => {
                const data = platMap[name];
                const row = document.createElement('div');
                row.className = 'p-row';
                row.innerHTML = `
                    <img src="${IMG + data.logo}" class="p-logo">
                    <div>
                        <div style="font-weight:bold; margin-bottom:8px; font-size:1.1rem;">${name}</div>
                        <div style="display:flex; flex-wrap:wrap; gap:8px;">
                            ${data.countries.map(c => `<span class="c-badge"><b>${c.code}</b> <span>${c.name}</span></span>`).join('')}
                        </div>
                    </div>
                `;
                pList.appendChild(row);
            });
        }
        
        function playTrailer(key) {
            if (!key) return;
            document.getElementById('youtubeFrame').src = `https://www.youtube.com/embed/${key}?autoplay=1`;
            document.getElementById('trailerModal').style.display = 'flex';
        }
        function closeTrailer() {
            document.getElementById('trailerModal').style.display = 'none';
            document.getElementById('youtubeFrame').src = '';
        }

        async function shareMovie(title, url) {
            if (navigator.share) {
                try { await navigator.share({ title: 'Watch ' + title, text: 'Check out on StreamFinder:', url: url }); } catch (err) {}
            } else {
                navigator.clipboard.writeText(url);
                alert('Link copied to clipboard!');
            }
        }

        function checkWatchlist(id) {
            const list = JSON.parse(localStorage.getItem('watchlist') || '[]');
            return list.some(item => item.id == id);
        }

        function toggleWatchlist(id, type, poster, title, vote) {
            let list = JSON.parse(localStorage.getItem('watchlist') || '[]');
            const index = list.findIndex(item => item.id == id);
            const btn = document.getElementById('wlBtn');

            if (index === -1) {
                list.push({ id, type, poster_path: poster, title: unescapeHtml(title), vote_average: parseFloat(vote) });
                btn.innerHTML = '✓ Remove from List';
                btn.classList.add('active');
            } else {
                list.splice(index, 1);
                btn.innerHTML = '+ Add to List';
                btn.classList.remove('active');
            }
            localStorage.setItem('watchlist', JSON.stringify(list));
            updateNavCount();
        }

        function updateNavCount() {
            const list = JSON.parse(localStorage.getItem('watchlist') || '[]');
            document.getElementById('navCount').innerText = list.length;
        }

        function escapeHtml(text) { return text.replace(/'/g, "&apos;").replace(/"/g, "&quot;"); }
        function unescapeHtml(text) { return text.replace(/&apos;/g, "'").replace(/&quot;/g, '"'); }
    </script>
</body>
</html>
