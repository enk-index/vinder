<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamfinder - Watch Everywhere</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #050508; --accent: #e50914; --text: #ffffff; --sub-text: #b3b3b3; --border: rgba(255, 255, 255, 0.1); --glass: rgba(10, 10, 15, 0.8); }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; width: 100%; position: relative; z-index: 2; }

        /* NAV */
        nav { position: sticky; top: 0; z-index: 1000; padding: 15px 0; transition: 0.4s; }
        nav.scrolled { background: var(--glass); backdrop-filter: blur(15px); border-bottom: 1px solid var(--border); }
        .nav-container { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: 900; text-decoration: none; color: #fff; letter-spacing: -1px; }
        .logo span { color: var(--accent); }

        /* HERO & SEARCH */
        .hero { padding: 80px 0 40px; text-align: center; }
        #searchInput { width: 100%; max-width: 600px; padding: 20px 30px; border-radius: 50px; border: 1px solid var(--border); background: rgba(255,255,255,0.05); color: #fff; font-size: 1.1rem; outline: none; backdrop-filter: blur(10px); }

        /* GRID */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; margin-top: 30px; }
        .card { background: #111; border-radius: 12px; overflow: hidden; cursor: pointer; transition: 0.3s; border: 1px solid var(--border); position: relative; }
        .card:hover { transform: translateY(-5px); border-color: var(--accent); }
        .card img { width: 100%; aspect-ratio: 2/3; object-fit: cover; }
        .card-info { padding: 12px; font-size: 0.85rem; }
        .badge { position: absolute; top: 10px; right: 10px; background: var(--accent); padding: 3px 8px; border-radius: 5px; font-size: 0.7rem; font-weight: bold; }

        /* DETAIL PAGE (Masalah Utama di Sini) */
        #detailPage { display: none; padding-top: 40px; }
        .detail-header { display: flex; gap: 40px; margin-bottom: 50px; flex-wrap: wrap; }
        .detail-poster { width: 300px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .detail-info { flex: 1; min-width: 300px; }
        .detail-title { font-size: 3rem; font-weight: 900; margin: 0 0 10px; }
        .detail-meta { color: var(--sub-text); margin-bottom: 20px; display: flex; gap: 15px; }
        .streaming-section { background: rgba(255,255,255,0.03); padding: 30px; border-radius: 20px; border: 1px solid var(--border); margin-top: 40px; }
        .stream-row { display: flex; align-items: center; gap: 15px; padding: 15px 0; border-bottom: 1px solid var(--border); }
        .stream-logo { width: 40px; height: 40px; border-radius: 8px; }

        .skeleton { background: #1a1a1a; height: 250px; border-radius: 12px; animation: pulse 1.5s infinite; }
        @keyframes pulse { 50% { opacity: 0.5; } }
        
        @media (max-width: 768px) { .detail-header { flex-direction: column; align-items: center; text-align: center; } }
    </style>
</head>
<body>

    <nav id="navbar">
        <div class="container nav-container">
            <a href="javascript:void(0)" onclick="showHome()" class="logo">STREAM<span>FINDER</span></a>
            <div style="display:flex; gap:20px;">
                <a href="javascript:void(0)" onclick="showHome()" style="color:#fff; text-decoration:none; font-weight:600;">Home</a>
            </div>
        </div>
    </nav>

    <main class="container">
        <div id="homeSection">
            <header class="hero">
                <h1 style="font-size: 3.5rem; font-weight: 900; margin-bottom: 30px;">Cari Film & TV.</h1>
                <input type="text" id="searchInput" placeholder="Ketik judul film atau genre...">
            </header>
            <h2 id="listLabel">Trending Sekarang</h2>
            <div id="mainGrid" class="grid"></div>
        </div>

        <div id="detailPage">
            <button onclick="showHome()" style="background:none; border:none; color:var(--accent); cursor:pointer; font-weight:bold; margin-bottom:20px;">‚Üê Kembali</button>
            <div id="detailContent"></div>
        </div>
    </main>

    <script>
        const API_KEY = 'a820f2b45d233c0cc0c97d078536074f';
        const IMG_URL = 'https://image.tmdb.org/t/p/w500';
        const ORIG_IMG = 'https://image.tmdb.org/t/p/original';

        // 1. Fungsi Toggle Tampilan (PENTING: Agar tidak duplikat)
        function showHome() {
            document.getElementById('homeSection').style.display = 'block';
            document.getElementById('detailPage').style.display = 'none';
            window.scrollTo(0,0);
        }

        function showDetail() {
            document.getElementById('homeSection').style.display = 'none';
            document.getElementById('detailPage').style.display = 'block';
            window.scrollTo(0,0);
        }

        // 2. Load Home Data
        async function fetchTrending() {
            const res = await fetch(`https://api.themoviedb.org/3/trending/all/day?api_key=${API_KEY}`);
            const data = await res.json();
            renderGrid(data.results);
        }

        function renderGrid(items) {
            const grid = document.getElementById('mainGrid');
            grid.innerHTML = items.map(m => `
                <div class="card" onclick="loadDetail('${m.media_type || (m.title ? 'movie' : 'tv')}', ${m.id})">
                    <div class="badge">${(m.media_type || 'movie').toUpperCase()}</div>
                    <img src="${m.poster_path ? IMG_URL + m.poster_path : 'https://via.placeholder.com/500x750'}" alt="${m.title || m.name}">
                    <div class="card-info">
                        <strong>${m.title || m.name}</strong><br>
                        <span style="color:var(--accent)">‚òÖ ${m.vote_average.toFixed(1)}</span>
                    </div>
                </div>
            `).join('');
        }

        // 3. Load Detail Data (Sesuai dengan screenshot Chainsaw Man Anda)
        async function loadDetail(type, id) {
            showDetail();
            const content = document.getElementById('detailContent');
            content.innerHTML = '<div class="skeleton"></div>'; // Loading state

            try {
                const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${API_KEY}&append_to_response=watch/providers`);
                const m = await res.json();

                const providers = m['watch/providers']?.results?.ID?.flatrate || []; // Wilayah Indonesia (ID)

                content.innerHTML = `
                    <div class="detail-header">
                        <img src="${ORIG_IMG + m.poster_path}" class="detail-poster">
                        <div class="detail-info">
                            <h1 class="detail-title">${m.title || m.name}</h1>
                            <div class="detail-meta">
                                <span>üìÖ ${m.release_date || m.first_air_date}</span>
                                <span>‚≠ê ${m.vote_average.toFixed(1)}</span>
                                <span>‚è±Ô∏è ${m.runtime || m.episode_run_time || '?'} min</span>
                            </div>
                            <p style="line-height:1.6; color:#ddd;">${m.overview || 'Tidak ada deskripsi.'}</p>
                            
                            <div class="streaming-section">
                                <h3>Streaming Tersedia di:</h3>
                                ${providers.length > 0 ? providers.map(p => `
                                    <div class="stream-row">
                                        <img src="${IMG_URL + p.logo_path}" class="stream-logo">
                                        <span>${p.provider_name}</span>
                                    </div>
                                `).join('') : '<p>Belum tersedia di platform streaming legal wilayah ini.</p>'}
                            </div>
                        </div>
                    </div>
                `;
            } catch (err) {
                content.innerHTML = '<p>Gagal memuat detail data.</p>';
            }
        }

        // Search logic
        document.getElementById('searchInput').oninput = async (e) => {
            const query = e.target.value;
            if(query.length > 2) {
                const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${API_KEY}&query=${query}`);
                const data = await res.json();
                renderGrid(data.results);
                document.getElementById('listLabel').innerText = `Hasil pencarian: "${query}"`;
            } else if(query.length === 0) {
                fetchTrending();
            }
        };

        window.onload = fetchTrending;
        window.onscroll = () => {
            const nav = document.getElementById('navbar');
            if (window.scrollY > 50) nav.classList.add('scrolled');
            else nav.classList.remove('scrolled');
        };
    </script>
</body>
</html>
